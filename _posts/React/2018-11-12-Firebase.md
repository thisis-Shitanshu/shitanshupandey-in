---
layout: post
title: "Firebase"
categories: Firebase
published: true
---

Authentication and Storage with Firebase

# #Introduction
- Create a Firebase Project on Firebase Project.
    - Register app for web.
    - Add Firebase SDK:
        - Copy `firebaseConfig`.
- Add firebase utility library:
    - `yarn add firebase`
    - Config firebase utils to setup sign-in.

    ```js
    import firebase from 'firebase/app';
    import 'firebase/firestore';
    import 'firebase/auth';

    const config = {
        // ... firebase Config
    };

    firebase.initializeApp(config);

    export const auth = firebase.auth();
    export const firestore = firebase.firestore();

    // Google Authentication Utils for Sign in with Pop Up
    const provider = new firebase.auth.GoogleAuthProvider();
    provider.setCustomParameters({ prompt: 'select_account' });
    export const signInWithGoogle = () => auth.signInWithPopup(provider);

    export default firebase;
    ```

- **Set up sign-in method from options avaiable**
- Setting up app to get user data in app state.
    - firebase authentication is an open subscription.
    - It give user authenticated session persistance by default.

    ```js
    // App listening to authentication state change.
    unsubscribeFromAuth = null;
  
    componentDidMount() {
        this.unsubscribeFromAuth = auth.onAuthStateChanged(user => {
        this.setState({
            currentUser: user
        });

        console.log(user);
        })
    }

    componentWillUnmount() {
        this.unsubscribeFromAuth();
    }
    ```

## #Firestore DB
- Create DB
    - Add Collection
        - Add Document
            - Collections...
                - Document...

- Read: Quering Database

```js
import firebase from 'firebase/app';
import 'firebase/firestore';

const firestore = firebase.firestore();

// #1
firestore.collection('users').doc('id').collection('cartItems').doc('id');

// #2
firestore.doc('/users/id/cartItems/id');
firestore.collection('/users/id/cartItems');
```

- Firestore gives back two potential objects:
    - QueryReference (references) and QuerySnapshot (snapshots):
        - Even if nothing exists.

- **QueryReference:**
    - An object that represents the "current" place in the database.
    - Syntax:
        - `firestore.doc('/users/:userId');`
        - `firestore.collections('/users');`
    - The object does not have the actual data of the collection or document.
        - It has the **properties** that tell us details about it.
        - or, the method to get the Snapshot object which gives us the data we are looking for.
    - It is used for SAVING or GET DATA from perticular data.
    - **DocumentReference vs CollectionReference**
        - documentRef objects perform CRUD methods and returns documentSnapshot:
            - .set()
            - .get()
                - Snapshot Object
                - Used to determine data in the current reference.
            - .update()
            - .delete()
        - collectionRef returns querySnapshot:
            - .add()
            - .get()

- **DocumentSnapshot:**
    - It's the object we get from documentReference object.
    - It allows us to check if document exits at this query using the `.exists` property.
    - We can also get actual properties on the object by calling the `.data()` method, which returns us a JSON object of the document.