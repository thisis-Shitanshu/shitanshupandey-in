---
layout: post
title: "React.js IV: PWA"
categories: React.js PWA
published: true
---
Notes on PWA.
Check PWA version [here](https://github.com/thisis-Shitanshu/crwn-clothing-ecommerce-react-firebase-stripe/tree/W/PWA).

# #Progessive Web Apps
- A Web App is a website that allows user to interect with the Web page. But it is inside of a browser window.
    - Uses: HTML, CSS, JS
- Native App is an App that is on a mobile phone.
    - Uses: Native Language
    - All the files are on the mobile phone
    - Can send push notifications
    - Work offline
    - Never gets a blank screen
    - Download on Online Store
    - Have access to device hardware
- PWA: Web Apps that behaves like Native Apps
    - In browser, removes URL Bar
    - Download them on phone
    - Work offline
    - Send push notifications
    - Hosted on Web Server, not on Stores
    - Uses `App Manifest` to add it to homescreen of the device

## #PWA Examples:
- pokedex.org
- hnpwa.com

# #PWA Elements: HTTPS
- HTTPS prevents bad actors from tempering with communication between App and Browser.
- PWA uses certain features that requires the use of HTTPS.
- Easiest way to get HTTPS: `letsencrypt.org`, `cloudflare.com`, `github pages`

# #PWA Elements: App Manifest
- For an PWA to behave like a Native App, we need to mimic views of the Native App.
- Need to have the meta tag: 
    - `<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">`
    - Adjust the screen size according to the device.
- We get `manifest.json` by default from create-react-app.
    - It's gives the ability to allow developer to decide how the app should appear to the user in the areas where they would expect to see apps.
        - Define how the app is going to launch/look.
    - Have `icons` defination for different devices sizes.
        - realfavicongenerator.net
            - Create Icons
            - Create Splashscreen

# #PWA Elements: Service Worker
- Service Worker is a script that the browser runs in the Background
    - Seperate from the Web Page/Web App.
- Used for features that does not need webpage or user interaction
    - A programable proxy
    - Allowing us to control what happens on Request-per-Request basis
    - Used for Background syncs and Push notifications
    - Allows for offline experience

## #Service Worker in React App
- React App uses `serviceWorker.js` to implement service worker.
    - In `index.js`: `serviceWorker.register()`

1. It checks for browser support of service worker.
1. Register a Service Worker using `service-worker.js` from react build.
    - Registering starts service worker installation steps with the other worker.
    - Once service worker is activated or registered, there're two success states:
        1. It's going to be terminated to save memory.
        1. Running in the background to fetch messages and events that occurs in the network request.

- With a Service Worker when the Browser send request to the server:
    1. Service Worker acts as a network proxy and checks for the file in;
        - Web API: Cache Storage API
    1. If not present than forwards the request to the server.

- **Steps with Express:**
    1. Import and register serviceWorker
    1. In server handle req for `/service-worker.js`
    1. Manifest is upto date with the icons that are require.

    ```js
    // manifest.json
    {
        "short_name": "Crwn-Clothing",
        "name": "Crwn-Clothing by Shitanshu",
        "icons": [
            {
            "src": "favicon.ico",
            "sizes": "64x64 32x32 24x24 16x16",
            "type": "image/x-icon"
            },
            {
            "src": "crwn-192x192.png",
            "type": "image/png",
            "sizes": "192x192"
            },
            {
            "src": "crwn-512x512.png",
            "type": "image/png",
            "sizes": "512x512"
            }	    
        ],
        "start_url": ".",
        "display": "standalone",
        "theme_color": "#000000",
        "background_color": "#ffffff"
    }
    ```

    1. Redirect any http req to https.
        - `yarn add express-sslify`
        - Implement in `server.js`:

        ```js
        const enforce = require('express-sslify');
        app.use(enforce.HTTPS({ trustProtoHeader: true }));
        ```