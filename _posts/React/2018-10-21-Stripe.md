---
layout: post
title: "Stripe"
categories: Stripe
published: true
---
- Setting up

# # Steps:
1. Sign-up/ Sign-in
    - To process real payment Stripe Account Activation is important.
1. Go to Developer section:
    - Get API keys.
        - Publishable key
        - Secret key
1. In your project:
    - `$ yarn add react-stripe-checkout`
1. Create the Button Component to handle payment.
    - Note: Stripe takes payment in cents.

    ```js
    import 'dotenv/config';

    import React from 'react';
    import StripeCheckout from 'react-stripe-checkout';

    import './stripe-button.styles.scss';

    const StripeCheckoutButton = ({ price }) => {
        const priceForStripe = price * 100;
        const publishableKey = process.env.REACT_APP_STRIPE_PULISHABLE_KEY;

        const onToken = token => {
            console.log(token);
            alert('Payment Successful');
        }

        return (
            <StripeCheckout
                label='Pay Now'
                name='CRWN Clothing Ltd.'
                billingAddress
                shippingAddress
                image='https://svgshare.com/i/CUz.svg'
                description={`Your total is $${price}`}
                amount={priceForStripe}
                panelLabel='Pay Now'
                token={onToken}
                stripeKey={publishableKey}
            />
        );
    };

    export default StripeCheckoutButton;
    ```

    - Import the button wherever you need to handle the payment.

- Stripe Test Credit Card:
    - 4242 4242 4242 4242
    - Exp: 01/20
    - CVV: 123

# #Backend

```js
const express = require('express');
const cors = require('cors');
const bodyParser = require('body-parser');
const path = require('path');

if (process.env.NODE_ENV !== 'production') require('dotenv').config();

const stripe = require('stripe')(process.env.STRIPE_SECRET_KEY);

const app = express();
const port = process.env.PORT || 5000;

app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: true }));

app.use(cors());

if(process.env.NODE_ENV === 'production') {
    app.use(express.static(path.join(__dirname, 'client/build')));

    app.get('*', function(req, res) {
        res.sendFile(path.join(__dirname, 'client/build', 'index.html'));
    })
}

app.listen(port, error => {
    if (error) {
        throw error;
    }
    console.log('Server running on port' + port);
});

app.post('/payment', (req, res) => {
    const body = {
        source: req.body.token.id,
        amount: req.body.amount,
        currency: 'usd'
    };

    stripe.charges.create(body, (stripeErr, stripeRes) => {
        if(stripeErr) {
            res.status(500).send({ error: stripeErr });
        } else {
            res.status(200).send({ success: stripeRes });
        }
    });
})
```