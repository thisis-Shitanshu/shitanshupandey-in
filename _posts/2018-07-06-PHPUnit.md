---
layout: post
title: "PHPUnit"
categories: PHP PHPUnit
published: true
---

Notes on Unit testing with PHPUnit. For quick snippet, click [here](https://gist.github.com/thisis-Shitanshu/de2b6730a15ecff8615032627fddf38d).

## #Testing
- Unit Testing, *"to isolate each part of the program and show that the individual parts are correct."*
- Acceptance testing are for business logic.
- Integration testing are for controllers.

## #Setting up PHPUnit
- Need to have Composer: Dependency Manager for PHP
- Install PHPUnit in the project: `$ composer require phpunit/phpunit`
- Run PHPUnit: `$ ./vendor/bin/phpunit`
- Create a `tests` dir in root.
- Setup autoloading:
    - Create `app` dir in root.
    - Add autoload script to `composer.json`:
        
        ```json
        "autoload": {
            "psr-4": {
                "App\\": "app"
            }
        }
        ```
    - Generate optimized autoload files: `$ composer dump-autoload -o`
- Configure PHPUnit: Specify everything from `tests`
    - Create `phpunit.xml` in the root.

        ```xml
        <?xml version="1.0" encoding="UTF-8"?>
        <phpunit bootstrap="vendor/autoload.php"
                colors="true"
                verbose="true"
                stopOnFailure="false">
            <testsuites>
                <testsuite name="Test suite">
                    <directory>tests</directory>
                </testsuite>
            </testsuites>
        </phpunit>
        ```

## #Writing Test
- In the `tests` dir, one needs to distinguish between different types of testing.
    - Create a `unit` dir in `tests` dir.
- Create test file in `unit` dir: `SampleTest.php`
    - Create a Class extending PHP framework TestCase.
    
    ```php
    <?php
    class SampleTest extends \PHPUnit\Framework\TestCase {
        // Every method is a test
        public function testTrueAssertsToTrue() {
            $this->assertTrue(true);
        }
    }
    ```

## Testing a User model
*Following TDD*
- Create `UserTest.php` in `unit` dir.
    
    ```php
    <?php

    class UserTest extends \PHPUnit\Framework\TestCase {
        
        public function testThatWeCanGetTheFirstName() {
            $user = new \App\Models\User;

            $user->setFirstName('Billy');

            $this->assertEquals($user->getFirstName(), 'Billy');
        }
    }
    ```
- Create `User.php` in `app/Models` dir.

```php
<?php

namespace App\Models;

class User {

    protected $first_name;

    public function setFirstName($firstName) {
        $this->first_name = $firstName;
    }

    public function getFirstName() {
        return $this->first_name;
    }
}
```

## #Using the setUp method
- In the extended TestCase Class add:
    
    ```php
    // Fresh User Model for each test
    protected $user;

    public function setUp(): void {
        $this->user = new \App\Models\User;
    }
    ```


## #Testing a Collection Class
- CollectionTest, click [here](https://gist.githubusercontent.com/thisis-Shitanshu/de2b6730a15ecff8615032627fddf38d/raw/32e542b7da63d8716db3e708c90cb717613a301e/CollectionTest.php).
- Collection Class, click [here](https://gist.githubusercontent.com/thisis-Shitanshu/de2b6730a15ecff8615032627fddf38d/raw/32e542b7da63d8716db3e708c90cb717613a301e/Collection.php).