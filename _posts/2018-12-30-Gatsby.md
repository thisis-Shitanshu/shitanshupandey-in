---
layout: post
title: "Gatsby"
categories: React Gatsby
published: true
---

Building sites with Gatsby

# #I. Introduction
- Gastby "Server Render" React to static HTML so sites load blazingly fast.
    - Then load minimal JS bundle for page to bootstrap to a full React app.
- With Gatsby you can add interactive/dynamic sections to website.
- Use Gatsby as **presentation layer** for CMS.
    - Traditinoal Monolith CMS
        - Presentation Layer + Content Backend
    - Decoupled CMS
        - Presentation Layer + CMS (Headless)
        - Gastby does with source plugins & GraphQL
        - Presentation Layer + **Build-time GraphQL** + Headeless CMS

## #1. Working with Gatsby
- Install throught CMD.
- Run `gastby develop` in the root to start the development server.
    - `localhost:8000`
- How Gatsy works:
    - You have pages directory if you had a react component their it becomes a page.
    - Gastby has a in-build `Link` component, where everything is client rendered.
        - It performs prefetching and makes going around the website feels like an app.
- You can use Gastby **Starter Library** to quick start an application.
- You can use different `gatsby-source` in `gastby-config.js` to set a backend plugin for a common Static Front-End.

# #II. Building Site
## #1. Installation

```
$ npm install -g gatsby-cli
$ gatsby --version
```

## #2. Creating a New Site
- Creating Project
```
$ gatsby new [project_name] [starter_template_name]
$ cd [project_name]
```

- Build site:
```
$ npm run develop
```

## #3. Linking Pages

```js
import Link from "gastby-link"

export default () =>    <div style={{color: 'tomato'}}>
                            <Link to="/page-2/">Page 2</Link>
                            <Link to="/dir/page-3/">Page 3</Link>
                            <Link to="/dir/counter/">Counter</Link>
                            <Link to="/">Home</Link>
                        </div>
```

## #4. Interative Pages
- You can have a page with state defined.

```js
// Counter Component
import React from "react"

class Counter extends React.Component {
    constructor() {
        super();
        this.state = { count: 0 };
    }

    render() {
        return (
            <div>
                <h1>Counter</h1>
                <p>current count: {this.state.count}</p>
                <button 
                    onClick={() => this.setState({ 
                        count: this.state.count + 1 
                    })} 
                >plus</button>
                <button 
                    onClick={() => this.setState({ 
                        count: this.state.count - 1 
                    })}
                >munis</button>
            </div>
        );
    };
}

export default Counter;
```

## #5. Building Your Site

```
$ npm run build
```

## #6. Plugins
- *"Plugins are Node.js packages that implements GatsbyAPIs."*
- Use:
    - Install plugins

    ```
    $ npm install -s gatsby-plugin-typography
    ```

    - create a `gatsby-config.js` in root.
        - Gatsby read this file everytime it rebuilds.
    
    ```js
    module.exports = {
        plugins: [`gatsby-plugin-typography`]
    }
    ```

## #7. Layouts
- Files that acts as a template for all the pages of our websites.
- Create a new dir `layouts` in the `src` with `index.js`.

```js
import React from "react"

export default ({ children }) => 
    <div>
        {children()}
    </div>
```

- Whenever you make a layout you need to restart the gatsby server.

## #8. Site Data
- edit `gastby-config.js`:

```js
module.exports = {
    siteMetadata: {
        title: "This is my Website",
        author: "Shitanshu"
    }
}
```

- Including data into a page using GraphQL

```js
import React from "react"

export default ({ data }) => (
    <div>
        <h1>{data.site.siteMetadata.title}</h1>
        <p>{data.site.siteMetadata.author}</p>
    </div>
);

export const query = graphql`
    query FirstQuery {
        site {
            siteMetadata {
                title
                author
            }
        }
    }
`
```

## #9. File Data
- Install gatsby-plugin for filesystem

```
$ npm install --save gatsby-source-filesystem
```

- Edit `gatsby-config.js`

```js
module.exports = {
    siteMetadata: {
        title: "This is my Website",
        author: "Shitanshu"
    },
    plugins: [
        {
            resolve: `gastby-source-filesystem`,
            options: {
                name: `src`,
                path: `${__dirname}/src/`
            }
        }
    ]
}
```

- Using File system in pages

```js
import React from "react"

export default ({ data }) => (
    <div>
        <table>
            <thead>
                <tr>
                    <th>realtivePath</th>
                    <th>prettySize</th>
                    <th>extension</th>
                    <th>birthTime</th>
                </tr>
            </thead>
            <tbody>
                {data.allFile.edges.map(({ node }) => 
                    <tr>
                        <td>{node.relativePath}</td>
                        <td>{node.prettySize}</td>
                        <td>{node.extension}</td>
                        <td>{node.birthTime}</td>
                    </tr>
                )}
            </tbody>
        </table>
    </div>
);

export const query = graphql`
    query MyFilesQuery {
        allFile {
            edges {
                node {
                    id
                    relativePath
                    prettySize
                    extension
                    birthTime(fromNow: true)
                }
            }
        }
    }
`
```

## #10. Working with Markdown
- Create a Markdown file in `pages` dir and add frontmatter.

```
---
title: "My Markdown File"
author: "Mike"
---

This is the content in my markdown.
```

- Install `gastby-transformer-remark`

```
$ npm install --save gastby-transformer-remark
```

- Edit `gastby-config.js`:
    - Just add the plugin in the plugin array.

- Now in GraphiQL you can query for

```
{
    allMarkdownRemark {
        edges {
            node {
                html
                frontmatter
                date
            }
        }
    }
}
```